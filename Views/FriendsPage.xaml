<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:SocialSyncApp.Models"
             x:Class="SocialSyncApp.Views.FriendsPage"
             Title="Friends"
             BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#0F0F0F}">

    <Grid RowDefinitions="Auto,*" Padding="15">

        <VerticalStackLayout Grid.Row="0" Spacing="10" Margin="0,0,0,15">
            <Grid ColumnDefinitions="*,Auto">
                <Label Text="My Friends" FontSize="24" FontAttributes="Bold" 
                       TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                       VerticalOptions="Center"/>
                <Button Grid.Column="1" Text="+ Add Friend" BackgroundColor="#6200EA" 
                        TextColor="White" CornerRadius="8" Clicked="OnAddFriendClicked"/>
            </Grid>
            <SearchBar Placeholder="Search friends..." BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#1E1E1E}"/>
        </VerticalStackLayout>

        <ActivityIndicator Grid.Row="1"
                           x:Name="LoadingSpinner"
                           IsRunning="True"
                           IsVisible="True"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Color="#6200EA"/>

        <RefreshView Grid.Row="1"
                     x:Name="FriendsRefreshView"
                     Command="{Binding LoadFriendsCommand}"
                     Refreshing="OnRefreshing"
                     IsVisible="False"
                     RefreshColor="#6200EA">

            <CollectionView x:Name="FriendsCollectionView"
                            SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                </CollectionView.ItemsLayout>

                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                        <Label Text="ðŸ‘¥" FontSize="40" HorizontalOptions="Center"/>
                        <Label Text="You haven't added any friends yet." TextColor="Gray" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Friend">
                        <Frame Padding="15" CornerRadius="12" HasShadow="True" 
                               BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#333}"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                            <VerticalStackLayout Spacing="15">
                                <Grid ColumnDefinitions="70,*,Auto" ColumnSpacing="15">

                                    <Frame Grid.Column="0" CornerRadius="35" Padding="0" 
                                           WidthRequest="70" HeightRequest="70" HasShadow="False"
                                           IsClippedToBounds="True">
                                        <Image Source="{Binding AvatarUrl}" Aspect="AspectFill"/>
                                    </Frame>

                                    <StackLayout Grid.Column="1" VerticalOptions="Center" Spacing="3">
                                        <Label Text="{Binding DisplayName}" 
                                               FontSize="17" 
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light=Black, Dark=White}"/>

                                        <Label Text="{Binding DisplayJob}" 
                                               FontSize="12" 
                                               TextColor="Gray"
                                               LineBreakMode="TailTruncation"/>

                                        <Label Text="{Binding SinceLabel}" 
                                               FontSize="11" 
                                               TextColor="#6200EA"/>
                                    </StackLayout>

                                </Grid>

                                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                    <Button Grid.Column="0" 
                                            Text="ðŸ‘¤ Profile" 
                                            BackgroundColor="#E0E0E0" 
                                            TextColor="Black" 
                                            CornerRadius="8" 
                                            HeightRequest="40"
                                            Padding="0"
                                            FontSize="13"
                                            Clicked="OnViewProfileClicked"
                                            CommandParameter="{Binding .}"/>

                                    <Button Grid.Column="1" 
                                            Text="âœ• Unfriend" 
                                            BackgroundColor="#FFEBEE" 
                                            TextColor="#C62828" 
                                            CornerRadius="8" 
                                            HeightRequest="40"
                                            Padding="0"
                                            FontSize="13"
                                            Clicked="OnUnfriendClicked"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

    </Grid>
</ContentPage>